

<html>
   <head>
      <script src="https://www.gstatic.com/firebasejs/4.6.0/firebase.js"></script>
			<script src="https://www.gstatic.com/firebasejs/4.6.0/firebase-messaging.js"></script>
			<script src="scripts/jquery-3.2.1.js"></script>
			<script src="scripts/fingerprint.js"></script>
      <script>
         // Initialize Firebase
         // TODO: Replace with your project's customized code snippet
         var config = {
					apiKey: "AIzaSyB8vsh1zWmVs1AXJK_piiwwdszAuCNbgAg",
					authDomain: "550151811080.firebaseapp.com",
					messagingSenderId: "550151811080",
			};
			firebase.initializeApp(config);
			const apiURL = "http://127.0.0.1:8000/";
			const device_id = new Fingerprint({canvas: true}).get();
			function setTokenSentToServer(token) {
				let data = {};
				data.device_id = device_id;
				data.token = token;
				
				$.post(apiURL+"register/",data).then(function(result)
				{
					console.log(result);
				});
			}
			function logEvent(event_name)
			{
				var event = {};
				event.device= device_id;
				event.event = event_name;
				$.post(apiURL+"log/",event).then(function(result)
				{
					console.log(result);
				});
			}
			function loader() 
			{
				logEvent("pageView")
					const messaging = firebase.messaging();
			
					messaging.requestPermission()
							.then(function() {
									console.log('Notification permission granted.');
									// TODO(developer): Retrieve an Instance ID token for use with FCM.
			
									// ...
			
									messaging.getToken()
											.then(function(currentToken) {
													if (currentToken) {
															setTokenSentToServer(currentToken);
															// updateUIForPushEnabled(currentToken);
															console.log(currentToken);
													} else {
															// Show permission request.
															console.log('No Instance ID token available. Request permission to generate one.');
															// Show permission UI.
															// updateUIForPushPermissionRequired();
															setTokenSentToServer(false);
													}
											})
											.catch(function(err) {
													console.log('An error occurred while retrieving token. ', err);
													console.log('Error retrieving Instance ID token. ', err);
													setTokenSentToServer(false);
											});
			
							})
							.catch(function(err) {
									console.log('Unable to get permission to notify.', err);
							});
			
					messaging.onMessage(function(payload) {
							console.log("Message received. ", payload);
							const notificationTitle = payload.data.title;
							const notificationOptions = {
									body: payload.data.body,
									icon: payload.data.logo
							};
							console.log(notificationOptions);
			
							navigator.serviceWorker.ready.then(function(registration) {
									registration.showNotification(notificationTitle, {
											body: payload.data.body,
											icon: payload.data.logo,
									});
							});
							// ...
					});
			
			}     
			$(document).ready(function() {
				loader();
			});
		 </script>
	 </head>
	 <body >
		 </body>
</html>

